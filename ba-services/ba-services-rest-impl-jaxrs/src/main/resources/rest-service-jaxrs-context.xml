<?xml version="1.0" encoding="UTF-8"?>

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:cxf="http://cxf.apache.org/core"
       xmlns:jaxrs="http://cxf.apache.org/jaxrs"
       xmlns:context="http://www.springframework.org/schema/context"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.5.xsd
	http://cxf.apache.org/core http://cxf.apache.org/schemas/core.xsd
    http://cxf.apache.org/jaxrs http://cxf.apache.org/schemas/jaxrs.xsd
    http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd
    http://www.springframework.org/schema/util http://www.springframework.org/schema/util/spring-util.xsd">

	<!-- Load CXF modules from cxf.jar -->
	<import resource="classpath:META-INF/cxf/cxf.xml" />
    <import resource="classpath:META-INF/cxf/cxf-extension-soap.xml" />
    <import resource="classpath:META-INF/cxf/cxf-servlet.xml" />

    <!-- Import the dal Spring context from the classpath -->
    <import resource="classpath:/dal-impl-jpa-context.xml" />


    <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer">
        <property name="locations">
            <list>
                <value>classpath:rest-service-jaxrs.properties</value>
            </list>
        </property>
        <property name="ignoreUnresolvablePlaceholders" value="true"/>
        <property name="ignoreResourceNotFound" value="true"/>
    </bean>

	<cxf:bus>
		<cxf:features>
			<cxf:logging />
		</cxf:features>
	</cxf:bus>

    <!-- REST SERVICE ENDPOINT CONFIGURATION - START -->
        <!-- To browse:
            - the services go to: http://host:port/cxf/api/v1
            - the wadl go to: http://host:port/cxf/api/v1?_wadl
            - the swagger api: http://host:port/cxf/api/v1/api-docs (as basepath set below)

            where for default karaf installation:
            - host: karaf_host_ip or karaf_host_name
            - port: 8181
        -->
    <jaxrs:server
            address="/api/v1"
            bus="cxf"
            staticSubresourceResolution="true">

        <jaxrs:serviceBeans>
            <ref bean="bankAccountsServices"/>
        </jaxrs:serviceBeans>

        <jaxrs:schemaLocations>
            <!--
            <jaxrs:schemaLocation>classpath:WEB-INF/wadl/customerprovisioning.wadl</jaxrs:schemaLocation>

            <jaxrs:schemaLocation>classpath:xsd/customers.xsd</jaxrs:schemaLocation>
            -->
        </jaxrs:schemaLocations>

        <jaxrs:providers>
            <ref bean="jaxbProvider"/>
            <ref bean="jsonjaxbProvider" />
            <ref bean="searchContextProvider"/>

            <ref bean="resourceWriter"/>
            <ref bean="apiWriter"/>
        </jaxrs:providers>
    </jaxrs:server>

    <!-- TO ObjectFactory  -->
    <bean id="bankAccountsObjectFactory"
          class="name.marmac.bankanalyzer.model.to.bankaccounts.ObjectFactory"/>

    <bean id="transactionsObjectFactory"
              class="name.marmac.bankanalyzer.model.to.transactions.ObjectFactory"/>

    <bean id="bankAnalyzerProperties"
          class="name.marmac.bankanalyzer.services.rest.properties.BankAnalyzerProperties" />

    <!-- REST API IMPL - JAXRS  -->
    <bean id="bankAccountsServices"
        class="name.marmac.bankanalyzer.services.rest.server.impl.jaxrs.BankAccountsServicesImplJaxrs">

        <property name="bankAccountsObjectFactory"          ref="bankAccountsObjectFactory"/>
        <property name="transactionsObjectFactory"          ref="transactionsObjectFactory"/>
        <property name="bankAnalyzerProperties"             ref="bankAnalyzerProperties" />
        <property name="bankAccountsPersistenceServices"    ref="bankAccountsPersistenceServices"/>

    </bean>

    <!-- XML Provider with JAXB2 -->
    <bean id="jaxbProvider" class="org.apache.cxf.jaxrs.provider.JAXBElementProvider">
        <property name="marshallAsJaxbElement" value="true"/>
    </bean>

    <!-- JSON Provider -->
    <bean id="jsonjaxbProvider" class="com.fasterxml.jackson.jaxrs.json.JacksonJaxbJsonProvider"/>

    <!-- -->
    <bean id="searchContextProvider" class="org.apache.cxf.jaxrs.ext.search.SearchContextProvider"/>

<!-- SWAGGER SPECIFIC CONFIGURATION - START -->
    <bean id="swaggerResourceJSON"  class="com.wordnik.swagger.jaxrs.listing.ApiListingResourceJSON" />
    <bean id="apiWriter"            class="com.wordnik.swagger.jaxrs.listing.ApiDeclarationProvider" />
    <bean id="resourceWriter"       class="com.wordnik.swagger.jaxrs.listing.ResourceListingProvider" />


    <!-- Swagger configuration -->
    <bean id="swaggerConfig" class="com.wordnik.swagger.jaxrs.config.BeanConfig">
        <property name="title"              value="BANK ACCOUNTS SERVICES REST API"/>
        <property name="version"            value="1.0.0"/>
        <property name="basePath"           value="/swagger" />
        <property name="resourcePackage"    value="name.marmac.bankanalyzer.services.rest.server.impl.jaxrs"/>
        <property name="scan"               value="true"/>

        <property name="description"        value="Bank Accounts Interface"/>
        <property name="contact"            value="marco.maccio@marmac.name"/>
        <property name="license"            value="Apache 2.0 License"/>
        <property name="licenseUrl"         value="http://www.apache.org/licenses/LICENSE-2.0.html"/>
    </bean>

    <!-- Exception mapper
    <bean id="exceptionMapper" class="com.wordnik.swagger.sample.resource.SampleExceptionMapper" />
    -->
<!-- SWAGGER SPECIFIC CONFIGURATION - END -->

</beans>

